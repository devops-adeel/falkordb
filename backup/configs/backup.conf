# FalkorDB Backup Configuration
# Configuration for backing up FalkorDB graph database
# Edit this file to customize backup behavior

# Backup destination directory
# For external drive, change this to: /Volumes/YOUR_DRIVE_NAME/FalkorDBBackups
# For NAS, change this to: /mnt/nas/FalkorDBBackups
BACKUP_BASE_DIR="${HOME}/FalkorDBBackups"

# Retention policy
RETENTION_DAILY=7      # Keep daily backups for 7 days
RETENTION_WEEKLY=4     # Keep weekly backups (Sunday) for 4 weeks

# Docker configuration
COMPOSE_PROJECT="falkordb"
CONTAINER_NAME="falkordb"

# OrbStack volume paths
ORBSTACK_VOLUMES="${HOME}/OrbStack/docker/volumes"
FALKORDB_VOLUME="falkordb_falkordb_data"

# FalkorDB connection settings
# For security, Redis password should be set in ~/.env file:
#   REDIS_PASSWORD="your-redis-password"
REDIS_HOST="${REDIS_HOST:-falkordb.local}"
REDIS_PORT="${REDIS_PORT:-6379}"

# Backup components (set to true/false to enable/disable)
BACKUP_RDB=true              # Core RDB backup
BACKUP_SCHEMA=true           # Graph structure via GRAPH.CONFIG
VALIDATE_RDB=true            # redis-check-rdb validation
TEST_RESTORE=false           # Periodic test restore to verify backup
CHECKSUM_VERIFY=true         # SHA256 checksum verification

# Notification settings (optional)
# NOTIFY_EMAIL=""
# NOTIFY_ON_SUCCESS=false
# NOTIFY_ON_FAILURE=true

# Slack notifications (optional)
# Set webhook URL in ~/.env for security:
#   SLACK_WEBHOOK="https://hooks.slack.com/services/..."
ENABLE_NOTIFICATIONS="${ENABLE_NOTIFICATIONS:-false}"

# External drive detection (optional)
# If set, backup will only run if this volume is mounted
# REQUIRED_VOLUME="/Volumes/FalkorDBBackup"

# S3 backup settings (optional)
# AWS credentials should be in ~/.env or ~/.aws/credentials
ENABLE_S3="${ENABLE_S3:-false}"
S3_BUCKET="${S3_BUCKET:-}"
S3_PREFIX="${S3_PREFIX:-falkordb-backups}"

# Compression level (1-9, higher = better compression but slower)
COMPRESSION_LEVEL=6

# Log retention (days)
LOG_RETENTION=30

# Monitoring metrics export
# Export backup metrics to Grafana Alloy for observability
METRICS_ENABLED="${METRICS_ENABLED:-true}"
METRICS_PORT=9099           # Port for metrics exporter (if using push gateway)
ALLOY_OTLP_HTTP="${ALLOY_OTLP_HTTP:-http://localhost:4318}"  # Alloy OTLP HTTP endpoint

# Validation settings
VALIDATE_GRAPHS=true         # Validate graph accessibility after backup
VALIDATE_CHECKSUMS=true      # Verify file checksums
VALIDATE_SIZE_MIN_MB=1       # Minimum expected backup size in MB (alert if smaller)

# Performance settings
BACKUP_TIMEOUT=3600          # Maximum time for backup operation (seconds)
RESTORE_TIMEOUT=3600         # Maximum time for restore operation (seconds)
PARALLEL_COMPRESSION=true    # Use parallel compression if available

# Test restore settings
TEST_RESTORE_CONTAINER="falkordb-test-restore"  # Container name for test restores
TEST_RESTORE_PORT=6380       # Port for test restore container (avoid conflicts)

# Backup triggers (for automated backups)
# These determine when automatic backups are triggered
TRIGGER_DAILY_HOUR=2         # Hour for daily backups (24-hour format)
TRIGGER_ON_SHUTDOWN=false    # Backup before container shutdown (requires hook)

# Advanced settings
DEBUG_MODE="${DEBUG_MODE:-false}"  # Enable debug logging
DRY_RUN="${DRY_RUN:-false}"       # Perform dry run without actual backup
FORCE_BACKUP="${FORCE_BACKUP:-false}"  # Force backup even if recent backup exists